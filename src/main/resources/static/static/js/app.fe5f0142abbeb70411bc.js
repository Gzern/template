webpackJsonp([14],{"+rhx":function(n,e){},LOkV:function(n,e,t){"use strict";t.d(e,"b",function(){return s}),t.d(e,"a",function(){return f});var r=t("mvHQ"),o=t.n(r),u=t("pFYg"),a=t.n(u),i=t("/5sW"),c=t("zL8q");t.n(c);i.default.component(c.Message.name,c.Message);var s=function(n,e){if(e)return("object"===(void 0===e?"undefined":a()(e))||Array.isArray(e))&&(e="autostringify-"+o()(e)),sessionStorage.setItem(n,e);var t=sessionStorage.getItem(n);return t&&0===t.indexOf("autostringify-")?JSON.parse(t.split("autostringify-")[1]):t},f=function n(e){if(!e)return e;var t=e instanceof Array?[]:{};for(var r in e)t[r]="object"===a()(e[r])?n(e[r]):e[r];return t}},NHnr:function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r={};t.d(r,"setUserInfo",function(){return A}),t.d(r,"setConfig",function(){return I});var o={};t.d(o,"isLogin",function(){return k}),t.d(o,"username",function(){return O}),t.d(o,"auth",function(){return U}),t.d(o,"factory",function(){return C}),t.d(o,"id",function(){return R}),t.d(o,"amount",function(){return N}),t.d(o,"currentConfig",function(){return F});var u=t("/5sW"),a=t("//Fk"),i=t.n(a),c=t("Dd8w"),s=t.n(c),f=[{path:"/",name:"Home",component:function(n){Promise.all([t.e(0),t.e(7)]).then(t.bind(null,"wqTG")).then(function(e){n(e)})},children:[{path:"/add",name:"Add",component:function(n){Promise.all([t.e(0),t.e(8)]).then(t.bind(null,"nn/n")).then(function(e){n(e)})}},{path:"/stock",name:"Stock",component:function(n){Promise.all([t.e(0),t.e(11)]).then(t.bind(null,"nTvh")).then(function(e){n(e)})}},{path:"/info",name:"Info",component:function(n){Promise.all([t.e(0),t.e(12)]).then(t.bind(null,"+fGT")).then(function(e){n(e)})}},{path:"/store",name:"Store",component:function(n){Promise.all([t.e(0),t.e(2)]).then(t.bind(null,"3tlU")).then(function(e){n(e)})}},{path:"/manager",name:"Manager",component:function(n){Promise.all([t.e(0),t.e(3)]).then(t.bind(null,"E1P1")).then(function(e){n(e)})}},{path:"/handle",name:"Handle",component:function(n){Promise.all([t.e(0),t.e(9)]).then(t.bind(null,"uSuN")).then(function(e){n(e)})}},{path:"/config",name:"Config",component:function(n){Promise.all([t.e(0),t.e(10)]).then(t.bind(null,"A49J")).then(function(e){n(e)})}},{path:"/log",name:"Log",component:function(n){Promise.all([t.e(0),t.e(5)]).then(t.bind(null,"7Tuw")).then(function(e){n(e)})}}]}],l=t("LOkV"),h=t("byEY"),d=t("NYxO"),m=void 0,p={name:"App",data:function(){return{menuData:null,userData:null}},methods:s()({},Object(d.b)(["setUserInfo"]),{getPermission:function(n){var e={};return Array.isArray(n)&&n.forEach(function(n,t){var r=n.method.toLowerCase()+","+n.url;e[r]=!0}),e},setInterceptor:function(n){m=h.a.interceptors.request.use(function(e){console.log(e.url);var t=e.url.replace(e.baseURL,"").replace("/GET","").replace("/POST","").split("?")[0];return console.log(t),n[e.method+","+t]?e:(console.warn(n,e.method+","+t),i.a.reject({message:"no permission"}))})},getRoutes:function(n){if(!n)return console.warn(n);var e=[];this.$root.hashMenus=n;return function t(r,o){var u=[];if(r.forEach(function(e){var r=(o?o+"/":"")+e.path;n[r]&&(Array.isArray(e.children)&&(e.children=t(e.children,e.path)),u.push(e))}),o)return u;e=e.concat(u)}(l.a(f[0].children)),e},extendRoutes:function(n){var e=this,t=l.a(n);t.map(function(n){return n.beforeEnter=function(n,t,r){e.$root.hashMenus[n.path]?r():r("/404")}});var r=l.a(f);r[0].children=t,this.$router.addRoutes(r.concat([{path:"*",redirect:"/404"}]))},signin:function(n){var e=this,t=l.b("token");if(l.b("expire",+new Date+6e5),h.a.interceptors.request.use(function(n){console.log(n);var t=+new Date,r=l.b("expire");return console.log("now",t),console.log("expire",r),r<t&&(e.$message.error("登录已过期"),e.logoutDirect()),n},function(n){return i.a.reject(n)}),h.a.interceptors.response.use(function(n){return n},function(n){if(n.response)switch(n.response.status){case 401:e.$message.error("401")}return i.a.reject(n.response.data)}),console.log("localUser",t),!t||!t.token)return console.log("未登录"),this.$router.push({path:"/login",query:{from:this.$router.currentRoute.path}});h.a.defaults.baseURL="http://localhost:8080",h.a.defaults.headers.common.token=t.token,h.a.get("/login/sign",{params:{token:t.token}}).then(function(t){var r=t.data;console.log(r);var o=r.data,a=o.roleInfo.roleFactory?o.userInfo.userFactory:"";console.log(a);var i={username:o.userInfo.userName,auth:o.roleName,factory:a};e.setUserInfo(i),e.setInterceptor(o.auth.resourcePermission);var c=e.getRoutes(o.auth.hashMenus);if(!c||!c.length)return l.b("token",""),document.body.innerHTML="<h1>账号访问受限，请联系系统管理员！</h1>";e.extendRoutes(c),e.menuData=c,e.userData=o,u.default.prototype.$_has=function(n){var e=[],t=!0;return Array.isArray(n)?n.forEach(function(n){e=e.concat(n.p)}):e=e.concat(n.p),e.forEach(function(n){if(!o.auth.resourcePermission[n])return t=!1}),t},"function"==typeof n&&n()}).catch(function(n){console.log(n)})},loginDirect:function(n){var e=this;this.signin(function(){e.$nextTick(function(){e.$router.replace({path:n||"/"})})})},logoutDirect:function(){l.b("token",""),l.b("expire",""),this.setUserInfo({username:"",auth:"",factory:""}),h.a.interceptors.request.eject(m),this.$root.hashMenus={},h.a.defaults.headers.common.token="",this.$router.replace({path:"/login"})}}),created:function(){this.signin()}},g={render:function(){var n=this.$createElement,e=this._self._c||n;return e("div",{attrs:{id:"app"}},[e("keep-alive",[e("router-view",{on:{login:this.loginDirect,logout:this.logoutDirect}})],1)],1)},staticRenderFns:[]};var v=t("VU/8")(p,g,!1,function(n){t("T5kA")},null,null).exports,E=t("/ocq");u.default.use(E.a);var T,S=[{path:"/login",name:"Login",component:function(n){t.e(1).then(t.bind(null,"mJTh")).then(function(e){n(e)})}},{path:"/reg",name:"Reg",component:function(n){t.e(4).then(t.bind(null,"BuhO")).then(function(e){n(e)})}},{path:"/404",name:"Not Found",component:function(n){t.e(6).then(t.bind(null,"Pzk/")).then(function(e){n(e)})}}],y=new E.a({routes:S}),b=t("zL8q"),_=t.n(b),A=(t("+rhx"),t("tvR6"),function(n,e){var t=n.commit;n.state;console.log(e),t("SET_USERNAME",e.username),t("SET_AUTH",e.auth),"factorier"===e.auth&&e.factory&&t("SET_FACTORY",e.factory)}),I=function(n,e){var t=n.commit;n.state;t("SET_CONFIG_USERNAME",e.username),t("SET_CONFIG_USERID",e.userId),t("SET_CONFIG_ROLE",e.role),t("SET_CONFIG_FACTORY",e.factory)},k=function(n){return n.isLogin},O=function(n){return n.currentUser.username},U=function(n){return n.currentUser.auth},C=function(n){return n.currentUser.factory},R=function(n){return n.currentStork.id},N=function(n){return n.currentStork.amount},F=function(n){return n.currentConfig},L={currentUser:{username:"",auth:"",factory:""},currentStork:{id:"",amount:""},currentConfig:{username:"",userId:"",role:"",factory:""},maxAge:864e4,isLogin:!1},P=t("bOdI"),M=t.n(P),w=(T={},M()(T,"SET_USERNAME",function(n,e){n.currentUser.username=e}),M()(T,"SET_AUTH",function(n,e){n.currentUser.auth=e}),M()(T,"SET_FACTORY",function(n,e){n.currentUser.factory=e}),M()(T,"SET_TEMPLATE_ID",function(n,e){n.currentStork.id=e}),M()(T,"SET_TEMPLATE_AMOUNT",function(n,e){n.currentStork.amount=e}),M()(T,"SET_CONFIG_USERNAME",function(n,e){n.currentConfig.username=e}),M()(T,"SET_CONFIG_USERID",function(n,e){n.currentConfig.userId=e}),M()(T,"SET_CONFIG_ROLE",function(n,e){n.currentConfig.role=e}),M()(T,"SET_CONFIG_FACTORY",function(n,e){n.currentConfig.factory=e}),T);t("sax8");u.default.use(d.a);var D=new d.a.Store({actions:r,getters:o,state:L,mutations:w,strict:!1,plugins:[]});u.default.use(_.a),u.default.config.productionTip=!1,u.default.directive("has",{bind:function(n,e){u.default.prototype.$_has(e.value)||n.parentNode.removeChild(n)}}),new u.default({el:"#app",router:y,store:D,render:function(n){return n(v)}})},T5kA:function(n,e){},byEY:function(n,e,t){"use strict";var r=t("mtWM"),o=t.n(r);t("LOkV");o.a.defaults.headers.post["Content-Type"]="application/json",e.a=o.a},tvR6:function(n,e){}},["NHnr"]);
//# sourceMappingURL=app.fe5f0142abbeb70411bc.js.map